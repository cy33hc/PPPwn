#!/usr/bin/env python3
#
# Copyright (C) 2024 Andy Nguyen
#
# This software may be modified and distributed under the terms
# of the MIT license.  See the LICENSE file for details.

import http.server as SimpleHTTPServer
from ExploitRequestHandler import *
from argparse import ArgumentParser
from sys import exit
import config

def main():
    parser = ArgumentParser('pppwn.py')
    parser.add_argument('--http-bind-address', required=True, help="IP address to start the http server on")
    parser.add_argument('--http-port', default=8000, type=int, required=True, help="Port number to start the http server on")
    parser.add_argument('--interface', required=True, help="The network interface used for executing the exploit on")
    parser.add_argument('--fw',
                        choices=[
                            '800', '801', '803', '850', '852',
                            '900', '903', '904', '950', '951', '960',
                            '1000', '1001', '1050', '1070', '1071',
                            '1100'
                        ],
                        default='1100', help="Firmware version of the PS4. Defaults to 1100 if not specified")
    parser.add_argument('--stage1', default='stage1/stage1.bin', help="The stage1 exploit payload. Defaults to \"stage1/stage1.bin\"")
    parser.add_argument('--stage2', default='stage2/stage2.bin', help="The stage2 exploit payload. Defaults to \"stage2/stage2.bin\"")
    args = parser.parse_args()

    config.interface = args.interface
    config.firmware = args.fw
    config.stage1 = args.stage1
    config.stage2 = args.stage2
    
    SimpleHTTPServer.test(HandlerClass=ExploitRequestHandler, port=args.http_port, bind=args.http_bind_address)

    return 0


if __name__ == '__main__':
    exit(main())
